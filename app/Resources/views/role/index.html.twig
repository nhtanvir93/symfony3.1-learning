{% extends 'base.html.twig' %}

{% block title %} Roles {% endblock %}

{% block body %}
    <h1 class="display-4">Roles</h1>

    <a class="btn btn-primary btn-sm mb-1" href="{{ path('create_role') }}">Add Role</a>

    {% include 'components/flash.html.twig' with { 'flashMessages' : app.session.flashbag.all } %}

    <table class="table table-striped table-hover table-bordered">
        <thead>
            <tr>
                <th width="20%" style="text-align: center;">Title</th>
                <th width="30%" style="text-align: center;">Description</th>
                <th width="20%" style="text-align: center;">Created At</th>
                <th width="30%" style="text-align: center;">Action</th>
            </tr>
        </thead>
        <tbody>
            {% for role in roles %}
                <tr>
                    <td style="text-align: center;">{{ role.title }}</td>
                    <td style="text-align: center;">{{ role.description }}</td>
                    <td style="text-align: center;">{{ role.createdAt | date('d/m/Y h:i A') }}</td>
                    <td style="text-align: center;">
                        <a class="btn btn-primary btn-sm mb-1"  href="{{ path('show_role', {'id' : role.id }) }}">Show</a>
                        <a class="btn btn-success btn-sm mb-1"  href="{{ path('edit_role', {'id' : role.id }) }}">Update</a>
                        <button
                            data-delete-url="{{ path('delete_role', { 'id' :  role.id }) }}"
                            class="btn btn-danger btn-sm mb-1"
                            onclick="deleteRole(event, '{{ role.id }}', '{{ role.title }}')">
                            Delete
                        </button>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="4" style="text-align: center; color: red;">No Data Found</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}

{% block javascripts %}
    <script>
        function deleteRoleRequest(url) {
            fetch(url,{
                method:'DELETE'
            }).then(response => {
                return response.json()
            }).then(data => {
                if(data.success) {
                    location.reload();
                }
            });
        }

        function deleteRole(event, roleId, roleName) {
            var isDeletePermissionGiven = confirm("Are you sure to delete '" + roleName + "' ?");

            if(isDeletePermissionGiven) {
                var url = event.target.getAttribute('data-delete-url');
                deleteRoleRequest(url);
            }
        }
    </script>
{% endblock %}