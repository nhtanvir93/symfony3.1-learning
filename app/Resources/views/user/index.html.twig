{% extends 'base.html.twig' %}

{% block title %} Roles {% endblock %}

{% block body %}
    <h1 class="display-4">Users</h1>

    <a class="btn btn-primary btn-sm mb-1" href="{{ path('create_user') }}">Add User</a>

    {% include 'components/flash.html.twig' with { 'flashMessages' : app.session.flashbag.all } %}

    <table class="table table-striped table-hover table-bordered">
        <thead>
            <tr>
                <th width="20%" style="text-align: center;">Username</th>
                <th width="20%" style="text-align: center;">Email</th>
                <th width="10%" style="text-align: center;">Mobile</th>
                <th width="20%" style="text-align: center;">Role</th>
                <th width="10%" style="text-align: center;">Created At</th>
                <th width="20%" style="text-align: center;">Action</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
                <tr>
                    <td style="text-align: center;">{{ user.username }}</td>
                    <td style="text-align: center;">{{ user.email }}</td>
                    <td style="text-align: center;">{{ user.mobile }}</td>
                    <td style="text-align: center;">{{ user.role.title }}</td>
                    <td style="text-align: center;">{{ user.createdAt | date('d/m/Y h:i A') }}</td>
                    <td style="text-align: center;">
                        <a class="btn btn-primary btn-sm mb-1"  href="{{ path('show_user', {'id' : user.id }) }}">Show</a>
                        <a class="btn btn-success btn-sm mb-1"  href="{{ path('edit_user', {'id' : user.id }) }}">Update</a>
                        <button
                            data-delete-url="{{ path('delete_user', { 'id' :  user.id }) }}"
                            class="btn btn-danger btn-sm mb-1"
                            onclick="deleteUser(event, '{{ user.id }}', '{{ user.username }}')">
                            Delete
                        </button>
                    </td>
                </tr>
            {% else %}
                <tr>
                    <td colspan="6" style="text-align: center; color: red;">No Data Found</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}

{% block javascripts %}
    <script>
        function deleteUserRequest(url) {
            fetch(url,{
                method:'DELETE'
            }).then(response => {
                return response.json()
            }).then(data => {
                if(data.success) {
                    location.reload();
                }
            });
        }

        function deleteUser(event, userId, username) {
            var isDeletePermissionGiven = confirm("Are you sure to delete '" + username + "' ?");

            if(isDeletePermissionGiven) {
                var url = event.target.getAttribute('data-delete-url');
                deleteUserRequest(url);
            }
        }
    </script>
{% endblock %}